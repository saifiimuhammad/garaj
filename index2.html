<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Second Animation - L Connectors</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root {
    --box-bg:#f6f9fd;
    --box-size:62px;
    --line-width:2.5;
    --grad-start:#000000;
    --grad-end:#EFA63E;
  }
  body {
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:#fff;
  }
  .anim { padding:60px 0; display:flex; justify-content:center; }
  .second-animation-container { position:relative; width:100%; max-width:1100px; }
  .second-right-section { position:relative; margin:0 auto; }
  .second-main {
    position:relative;
    min-width:566px;
    min-height:520px;
    width:100%;
    max-width:760px;
    aspect-ratio:760/600;
  }

  .mobile-border-svg.second-svg-main,
  .second-mobile-img { pointer-events:none; user-select:none; }

  .second-boxes {
    position:absolute;
    width:var(--box-size);
    height:var(--box-size);
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:16px;
    background:var(--box-bg);
    box-shadow:0 4px 12px -4px rgba(0,0,0,.12);
    z-index:10;
    overflow:hidden;
    cursor:default;
    transition:outline .3s;
  }
  .second-boxes img {
    position:absolute;
    width:38px;
    height:38px;
    transition:opacity .35s ease;
  }
  .second-boxes .icon-colored { opacity:0; }
  .second-boxes.active .icon-default { opacity:0; }
  .second-boxes.active .icon-colored { opacity:1; }
  .second-boxes:hover { outline:2px solid var(--grad-end); }

  #connectorLayer {
    position:absolute;
    inset:0;
    width:100%; height:100%;
    overflow:visible;
    pointer-events:none;
    z-index:5;
  }
  #connectorLayer path {
    fill:none;
    stroke-width:var(--line-width);
    stroke-linejoin:round;
    stroke-linecap:round;
    stroke:url(#lineGradient);
    filter:drop-shadow(0 0 4px rgba(239,166,62,.35));
  }
  #connectorLayer path.dim { opacity:.35; }

  .pulse-path { animation:pulseStroke 1.2s ease-in-out; }
  @keyframes pulseStroke {
    0% { stroke-width:var(--line-width); }
    50% { stroke-width:calc(var(--line-width)*1.9); }
    100% { stroke-width:var(--line-width); }
  }
  .second-boxes.glow { animation:glowBox 1.4s ease-in-out; }
  @keyframes glowBox {
    0% { box-shadow:0 4px 12px -4px rgba(239,166,62,0); }
    50%{ box-shadow:0 6px 22px -4px rgba(239,166,62,.55); }
    100%{ box-shadow:0 4px 12px -4px rgba(239,166,62,0); }
  }

  @media (max-width:900px){
    .second-main { min-width:min(100%,520px); }
  }
  @media (max-width:600px){
    .second-main { min-width:100%; aspect-ratio:3/4; }
    .second-boxes { width:54px; height:54px; }
  }
</style>
</head>
<body>

<div class="anim anim-second" id="anim-second">
  <div class="second-animation-container">
    <div class="second-right-section">
      <div class="second-main" id="secondMain">

        <!-- CONNECTOR SVG -->
        <svg id="connectorLayer">
          <defs>
            <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#000"/>
              <stop offset="100%" stop-color="#EFA63E"/>
            </linearGradient>
            <linearGradient id="travellerGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="rgba(255,255,255,0)"/>
              <stop offset="50%" stop-color="rgba(255,255,255,.85)"/>
              <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
            </linearGradient>
          </defs>
          <!-- One L path per box (goes right to phone border) -->
          <path id="path-left-top" />
          <path id="path-left-bottom" />
          <path id="path-right-top" />
          <path id="path-right-bottom" />
          <!-- Optional sweep -->
            <path id="traveller" stroke="url(#travellerGradient)" stroke-width="5" opacity="0" />
        </svg>

        <!-- Phone border -->
        <svg viewBox="0 0 521 985"
             class="mobile-border-svg second-svg-main"
             id="phoneBorder"
             style="position:absolute;left:50%;top:50%;width:65%;height:102%;transform:translate(-50%,-50%);z-index:3;"
             fill="none">
          <rect x="2.06055" y="2.28711" width="516" height="980" rx="68"
                stroke="url(#phoneBorderGradient)" stroke-width="4"/>
          <defs>
            <linearGradient id="phoneBorderGradient" x1="260.061" y1="0.287" x2="260.061" y2="984.287" gradientUnits="userSpaceOnUse">
              <stop stop-color="#000"/>
              <stop offset="0.5" stop-color="#EFA63E"/>
            </linearGradient>
          </defs>
        </svg>

        <!-- Phone image -->
        <img src="./assets/images/mobile.svg" alt="mobile"
             class="second-mobile-img" id="phoneImg"
             style="position:absolute;left:50%;top:50%;width:80%;height:100%;max-width:520px;transform:translate(-50%,-50%);z-index:2;" />

        <!-- Boxes -->
        <div class="second-boxes" id="boxLeftTop" style="left:0;top:62px;">
          <img src="./assets/icons/1.svg" class="icon-default" alt="">
          <img src="./assets/icons/1_color.svg" class="icon-colored" alt="">
        </div>
        <div class="second-boxes" id="boxLeftBottom" style="left:0;bottom:62px;">
          <img src="./assets/icons/2.svg" class="icon-default" alt="">
          <img src="./assets/icons/2_color.svg" class="icon-colored" alt="">
        </div>
        <div class="second-boxes" id="boxRightTop" style="right:0;top:62px;">
          <img src="./assets/icons/3.svg" class="icon-default" alt="">
          <img src="./assets/icons/3_color.svg" class="icon-colored" alt="">
        </div>
        <div class="second-boxes" id="boxRightBottom" style="right:0;bottom:62px;">
          <img src="./assets/icons/2.svg" class="icon-default" alt="">
          <img src="./assets/icons/2_color.svg" class="icon-colored" alt="">
        </div>

      </div>
    </div>
  </div>
</div>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"
        integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/* CONFIG */
const BUS_OFFSET_RATIO = 0.50;   // vertical level where L turns
const H_GAP = 0;                 // 0 so we *touch* phone image border
const DRAW_SPEED = 0.55;         // per line
const LOOP_DELAY = 0.9;

/* DOM */
const container = document.getElementById("secondMain");
const phoneImg  = document.getElementById("phoneImg");
const boxes = {
  leftTop: document.getElementById("boxLeftTop"),
  leftBottom: document.getElementById("boxLeftBottom"),
  rightTop: document.getElementById("boxRightTop"),
  rightBottom: document.getElementById("boxRightBottom")
};
const paths = {
  leftTop: document.getElementById("path-left-top"),
  leftBottom: document.getElementById("path-left-bottom"),
  rightTop: document.getElementById("path-right-top"),
  rightBottom: document.getElementById("path-right-bottom"),
  traveller: document.getElementById("traveller")
};

let masterTL;

/* Compute one L path to phone border for each box */
/* Compute one L path to phone border for each box */
function computePaths() {
  const cRect      = container.getBoundingClientRect();
  const borderRect = phoneBorder.getBoundingClientRect();   // <-- use border, not image
  // If you truly want to use the image, swap borderRect for phoneImg.getBoundingClientRect()

  const BORDER_STROKE = 4;      // stroke-width on the phone border <rect>
  const OVERLAP       = 2;      // how many px to push line *into* the phone (avoid visible gap)
  const BUS_OFFSET_RATIO = 0.50; // keep same if you changed it globally

  // No inset padding now; we *want* to touch/overlap
  const phoneInner = {
    left:   borderRect.left   - cRect.left + (BORDER_STROKE / 2) - OVERLAP,
    right:  borderRect.right  - cRect.left - (BORDER_STROKE / 2) + OVERLAP,
    top:    borderRect.top    - cRect.top,
    bottom: borderRect.bottom - cRect.top
  };

  const busY = cRect.height * BUS_OFFSET_RATIO;

  const toLocal = (x,y)=>({ x: x - cRect.left, y: y - cRect.top });
  const anchor = (el, which) => {
    const r = el.getBoundingClientRect();
    const cx = r.left + r.width / 2;
    const y  = which === "bottomCenter" ? r.bottom : r.top;
    return toLocal(cx, y);
  };

  const lt = anchor(boxes.leftTop, "bottomCenter");
  const lb = anchor(boxes.leftBottom, "topCenter");
  const rt = anchor(boxes.rightTop, "bottomCenter");
  const rb = anchor(boxes.rightBottom,"topCenter");

  // Build L shapes that end exactly at (or slightly inside) the phone border
  paths.leftTop.setAttribute("d",
    `M ${lt.x} ${lt.y} L ${lt.x} ${busY} L ${phoneInner.left} ${busY}`);
  paths.leftBottom.setAttribute("d",
    `M ${lb.x} ${lb.y} L ${lb.x} ${busY} L ${phoneInner.left} ${busY}`);

  paths.rightTop.setAttribute("d",
    `M ${rt.x} ${rt.y} L ${rt.x} ${busY} L ${phoneInner.right} ${busY}`);
  paths.rightBottom.setAttribute("d",
    `M ${rb.x} ${rb.y} L ${rb.x} ${busY} L ${phoneInner.right} ${busY}`);

  // Traveller across the *phone width* (optional)
  paths.traveller.setAttribute("d",
    `M ${phoneInner.left + OVERLAP} ${busY} L ${phoneInner.right - OVERLAP} ${busY}`);

  // Reset dash arrays
  Object.values(paths).forEach(p=>{
    if (!p) return;
    const L = p.getTotalLength();
    p.style.strokeDasharray  = L;
    p.style.strokeDashoffset = L;
  });
}

/* Build sequential timeline */
function buildTimeline() {
  if (masterTL) masterTL.kill();
  masterTL = gsap.timeline({ repeat:-1, repeatDelay:LOOP_DELAY, defaults:{ ease:"power2.out" } });

  // reset
  Object.values(paths).forEach(p=>{
    const L = p.getTotalLength();
    gsap.set(p,{ strokeDashoffset:L, opacity: p.id==='traveller'?0:1 });
    p.classList.remove('dim');
  });

  function draw(key) {
    const el = paths[key];
    masterTL.to(el, {
      strokeDashoffset:0,
      duration: DRAW_SPEED,
      onComplete: () => activateBoxes([ boxForPath(key) ])
    });
  }

  draw("leftTop");
  draw("leftBottom");
  draw("rightTop");
  draw("rightBottom");

  // Traveller sweep after all lines
  const busLen = paths.traveller.getTotalLength();
  gsap.set(paths.traveller,{
    strokeDasharray: busLen/5 + " " + busLen,
    strokeDashoffset:0
  });

  masterTL.to(paths.traveller,{ opacity:1, duration:0.15 })
          .to(paths.traveller,{
              strokeDashoffset: -busLen,
              duration:1.3,
              ease:"none"
            })
          .to(paths.traveller,{ opacity:0, duration:0.25 });

  masterTL.add(()=>{
    ["leftTop","leftBottom","rightTop","rightBottom"].forEach(k=>{
      paths[k].classList.add("dim");
    });
  }, ">-0.2");
}

/* Helper: map path key to box element */
function boxForPath(pathKey){
  switch(pathKey){
    case "leftTop": return boxes.leftTop;
    case "leftBottom": return boxes.leftBottom;
    case "rightTop": return boxes.rightTop;
    case "rightBottom": return boxes.rightBottom;
  }
}

/* Box activation */
function activateBoxes(list){
  list.forEach(b=>{
    if (!b) return;
    b.classList.add("active","glow");
    setTimeout(()=>b.classList.remove("glow"), 1200);
    setTimeout(()=>b.classList.remove("active"), 1400);
    // pulse line
    const pathId = "path-" + b.id.replace("box","").toLowerCase();
    const p = document.getElementById(pathId);
    if (p){
      p.classList.add("pulse-path");
      setTimeout(()=>p.classList.remove("pulse-path"),1200);
    }
  });
}

/* Hover effect (pulse only; does not change timing) */
Object.values(boxes).forEach(box=>{
  box.addEventListener("mouseenter", ()=>{
    box.classList.add("active");
    const pathId = "path-" + box.id.replace("box","").toLowerCase();
    const p = document.getElementById(pathId);
    if (p) p.classList.add("pulse-path");
  });
  box.addEventListener("mouseleave", ()=>{
    box.classList.remove("active");
  });
});

function init(){
  computePaths();
  buildTimeline();
}

window.addEventListener("load", init);
window.addEventListener("resize", ()=>{
  computePaths();
  buildTimeline();
});
</script>
</body>
</html>
